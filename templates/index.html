<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Medical Health Care </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
      <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">

    <style>
        .logo {
            width: 50px;
            height: 50px;
            color: black;
            margin-top: 0;
            margin-left: 2px;
        }

        .myimg {
            width: 50px;
            height: 50px;
            border: 2px solid black;
            border-radius: 25px;
        }

        /* Input styling for the now editable field */
        input[type="text"] {
            background-color: #111;
            border: 1px solid #ff1a1a;
            color: #ffffff;
            padding: 10px;
            border-radius: 6px;
        }

        input[type="text"]::placeholder {
            color: #bbbbbb;
        }

        input[type="text"]:focus {
            background-color: #000;
            border-color: #ff3333;
            color: #ffffff;
            box-shadow: 0 0 10px #ff1a1a;
        }

        /* Style for the modal checkboxes */
        #symptomCheckboxes {
            columns: 2; /* Two columns for checkboxes for better display */
            column-gap: 20px;
        }
        .form-check {
            margin-bottom: 5px;
            break-inside: avoid;
        }

        /* FIX for Modal Text Visibility */
        .modal-body .form-check-label {
            color: #000000 !important;
        }

        .modal-body .form-check-label span {
            color: #555555 !important;
        }

        .modal-body p {
            color: #000000 !important;
        }

        /* Doctor Suggestion Button Style */
        .doctor-btn {
            background: #2596be !important; /* Blue color */
            color: white !important;
        }

        /* Large Mic Icon Style for Voice Input */
        .large-mic {
            font-size: 8rem; /* Very large icon */
            color: #ff1a1a; /* Red color for recording */
            animation: pulse 1s infinite alternate; /* Simple pulsing effect */
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(1.1); opacity: 1; }
        }

    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <div class="logo">
            <img class="myimg" src="{{ url_for('static', filename='img.png') }}" alt="">
        </div>

        <a class="navbar-brand" href="{{ url_for('home') }}">Medical Health Care</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="{{ url_for('home') }}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/contact">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/developer">Developer</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog">Blog</a>
                </li>
            </ul>

            <div class="d-flex">
                {% if current_user.is_authenticated %}
                    <span class="navbar-text me-3 text-white">
                        üëã ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, **{{ current_user.username }}**!
                    </span>
                    <a class="btn btn-outline-danger" href="{{ url_for('logout') }}">
                        <i class="bi bi-box-arrow-right"></i> ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü(Logout)
                    </a>
                {% else %}
                    <a class="btn btn-outline-light me-2" href="{{ url_for('login') }}">
                        üîë ‡§≤‡•â‡§ó‡§ø‡§®(Login)
                    </a>
                    <a class="btn btn-outline-warning" href="{{ url_for('signup') }}">
                        ‚ûï ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™(SignUp)
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<!--    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">-->
<!--        <div class="container-fluid">-->
<!--            <div class="logo">-->
<!--                <img class="myimg" src="{{ url_for('static', filename='img.png') }}" alt="">-->
<!--            </div>-->

<!--            <a class="navbar-brand" href="#">Medical Health Care</a>-->
<!--            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">-->
<!--                <span class="navbar-toggler-icon"></span>-->
<!--            </button>-->
<!--            <div class="collapse navbar-collapse" id="navbarSupportedContent">-->
<!--                <ul class="navbar-nav me-auto mb-2 mb-lg-0">-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link active" aria-current="page" href="#">Home</a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link" href="/about">About</a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link" href="/contact">Contact</a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link" href="/developer">Developer</a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a class="nav-link" href="/blog">Blog</a>-->
<!--                    </li>-->
<!--                </ul>-->
<!--                <form class="d-flex" role="search">-->
<!--                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">-->
<!--                    <button class="btn btn-outline-success" type="submit">Search</button>-->
<!--                </form>-->
<!--            </div>-->
<!--        </div>-->
<!--    </nav>-->

<h1 class="mt-4 my-4 text-center text-green">Medical Health Care</h1>
<div class="container my-4 mt-4" style="background: black; color: white; border-radius: 15px; padding: 40px;">
    <form action="/predict" method="post">
        <div class="form-group">
            <div class="row mb-3">
    <div class="col-md-12 text-center">
        <a href="/" class="btn btn-warning btn-lg">
            üÜï‡§®‡§è ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•á‡§ú ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç (Refresh The Page for new symptoms...)
        </a>
    </div>
</div>
            <label for="symptoms">‡§≤‡§ï‡•ç‡§∑‡§£ ‡§ö‡•Å‡§®‡•á‡§Ç (Select Symptoms):</label>
            <input type="text" class="form-control" id="symptoms" name="symptoms"
                   placeholder="‡§≤‡§ï‡•ç‡§∑‡§£ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§æ ‡§®‡•Ä‡§ö‡•á ‡§¶‡•Ä ‡§ó‡§à ‡§∏‡•Ç‡§ö‡•Ä ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç‡•§ (Type symptoms manually, or select from the list below...)"
                   style="color: #ffffff;">

            <button type="button" class="btn btn-success mt-2" data-bs-toggle="modal" data-bs-target="#symptomSelectModal">
                ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§ñ‡•ã‡§≤‡•á‡§Ç (Open Symptom List)
            </button>

        </div>
        <br>
        <button type="button" id="startSpeechRecognition" class="btn btn-primary" style="margin-left:3px;border:1px solid white; border-radius:20px;">
            <i class="bi bi-mic-fill"></i> Voice Input (‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡•ã‡§≤‡•á‡§Ç)
        </button>
        <br>

        <div name="mysysms" id="transcription" class="mt-2 text-warning" style="font-style: italic;"></div>

        {% if message %}
        <p>{{ message }}</p>
        {% endif %}
        <br>

        <button type="submit" class="btn btn-danger btn-lg" style="width: 100%; padding: 14px; margin-bottom: 5px;">Predict-Disease‚Äú‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§ú‡§æ‡§®‡•á‡§Ç‚Äù</button>
    </form>
</div>


{% if predicted_disease %}
<h1 class="text-center my-4 mt-4">Our AI System Results</h1>
<div class="container">
    <div class="result-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#diseaseModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px; border-radius:5px; background:#F39334;color:black;">Disease</button>
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#descriptionModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px; border-radius:5px; background:#268AF3 ;color:black;">Description</button>
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#precautionModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px; border-radius:5px; background:#F371F9 ;color:black;">Precaution</button>
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#medicationsModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px;border-radius:5px; background:#F8576F ;color:black;">Medications</button>
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#workoutsModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px; border-radius:5px; background:#99F741 ;color:black;">Workouts</button>
        <button class="toggle-button" data-bs-toggle="modal" data-bs-target="#dietsModal" style="padding:4px; font-size:20px;font-weight:bold; width:140px; border-radius:5px; background:#E5E23D;color:black;">Diets</button>

        <button class="toggle-button doctor-btn" data-bs-toggle="modal" data-bs-target="#doctorsModal" style="padding:4px; font-size:20px;font-weight:bold; width:220px; border-radius:5px;">
            Doctor's Suggestion
        </button>
    </div>
</div>
{% endif %}


<div class="modal fade" id="symptomSelectModal" tabindex="-1" aria-labelledby="symptomSelectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #020606; color:white;">
                <h5 class="modal-title" id="symptomSelectModalLabel">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§ö‡•Å‡§®‡•á‡§Ç (Choose Your Symptoms)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="symptomCheckboxes">
                <p>‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§≤‡•ã‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç(Close)</button>
                <button type="button" class="btn btn-primary" id="submitSymptoms" data-bs-dismiss="modal">‡§∏‡§ø‡§Æ‡•ç‡§™‡•ç‡§ü‡§Æ ‡§≠‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç(Select the Symptoms and close..)</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="micModal" tabindex="-1" aria-labelledby="micModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white text-center">
                <h5 class="modal-title w-100" id="micModalLabel">üó£Ô∏è ‡§¨‡•ã‡§≤‡•á‡§Ç (Speak Now)</h5>
            </div>
            <div class="modal-body text-center">
                <i class="bi bi-mic-fill large-mic"></i>
                <p class="mt-3 text-muted">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§§‡§æ‡§è‡§Ç...</p>
                <h4 id="liveTranscription" class="mt-3 text-primary"></h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="stopRecognitionManually()">
                    ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§ø‡§Ç‡§ó ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç (Stop Recording)
                </button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="diseaseModal" tabindex="-1" aria-labelledby="diseaseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #020606; color:white;">
                <h5 class="modal-title" id="diseaseModalLabel">Predicted Disease</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>{{ predicted_disease }}</p>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="doctorsModal" tabindex="-1" aria-labelledby="doctorsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="doctorsModalLabel">üë®‚Äç‚öïÔ∏èDoctor's Suggestion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h4 id="suggestedExpert"></h4>
                <p id="suggestionDetails"></p>
                <p class="text-muted"><small>‡§Ø‡§π ‡§è‡§ï AI-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§ü‡•Ä‡§ï ‡§®‡§ø‡§¶‡§æ‡§® ‡§î‡§∞ ‡§â‡§™‡§ö‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§∂‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§≤‡•á‡§Ç‡•§ (This is an AI-based suggestion. Always consult an expert doctor for accurate diagnosis and treatment.)</small></p>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #020606; color:white;">
                    <h5 class="modal-title" id="descriptionModalLabel">Description</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>{{ dis_des }}</p>
                </div>
            </div>
        </div>
    </div>

<div class="modal fade" id="precautionModal" tabindex="-1" aria-labelledby="precautionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #020606; color:white;">
                    <h5 class="modal-title" id="precautionModalLabel">Precaution</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        {% for i in my_precautions %}
                            <li>{{ i }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="medicationsModal" tabindex="-1" aria-labelledby="medicationsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #020606; color:white;">
                    <h5 class="modal-title" id="medicationsModalLabel">Medications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        {% for i in medications %}
                            <li>{{ i }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="workoutsModal" tabindex="-1" aria-labelledby="workoutsModalLabel" aria-hidden="true">
        <div class="modal-dialog" >
            <div class="modal-content">
                <div class="modal-header" style="background-color: #020606; color:white;">
                    <h5 class="modal-title" id="workoutsModalLabel">Workouts</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        {% for i in workout %}
                            <li>{{ i }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="dietsModal" tabindex="-1" aria-labelledby="dietsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #020606; color:white;">
                    <h5 class="modal-title" id="dietsModalLabel">Diets</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        {% for i in my_diet %}
                            <li>{{ i }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>


    <script>
        // Global variable for recognition instance
        let recognition = null;

        // =================================================================
        // Symptoms Selection & Mapping Data (Comprehensive Hindi/English Map)
        // =================================================================

        const symptomMap = {
            'itching': '‡§ñ‡•Å‡§ú‡§≤‡•Ä', 'skin_rash': '‡§§‡•ç‡§µ‡§ö‡§æ ‡§™‡§∞ ‡§¶‡§æ‡§®‡•á', 'nodal_skin_eruptions': '‡§§‡•ç‡§µ‡§ö‡§æ ‡§ï‡•Ä ‡§ó‡§æ‡§Ç‡§†‡§¶‡§æ‡§∞ ‡§â‡§¶‡•ç‡§≠‡•á‡§¶‡§®',
            'continuous_sneezing': '‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§õ‡•Ä‡§Ç‡§ï‡§®‡§æ', 'shivering': '‡§ï‡§Ç‡§™‡§ï‡§Ç‡§™‡•Ä', 'chills': '‡§†‡§Ç‡§° ‡§≤‡§ó‡§®‡§æ',
            'joint_pain': '‡§ú‡•ã‡§°‡§º‡•ã‡§Ç ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§¶', 'stomach_pain': '‡§™‡•á‡§ü ‡§¶‡§∞‡•ç‡§¶', 'acidity': '‡§è‡§∏‡§ø‡§°‡§ø‡§ü‡•Ä',
            'ulcers_on_tongue': '‡§ú‡•Ä‡§≠ ‡§™‡§∞ ‡§õ‡§æ‡§≤‡•á', 'muscle_wasting': '‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§ï‡•ç‡§∑‡§Ø', 'vomiting': '‡§â‡§≤‡•ç‡§ü‡•Ä',
            'burning_micturition': '‡§™‡•á‡§∂‡§æ‡§¨ ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡§®', 'spotting_ urination': '‡§™‡•á‡§∂‡§æ‡§¨ ‡§Æ‡•á‡§Ç ‡§ß‡§¨‡•ç‡§¨‡•á', 'fatigue': '‡§•‡§ï‡§æ‡§®',
            'weight_gain': '‡§µ‡§ú‡§® ‡§¨‡§¢‡§º‡§®‡§æ', 'anxiety': '‡§ö‡§ø‡§Ç‡§§‡§æ', 'cold_hands_and_feets': '‡§π‡§æ‡§•-‡§™‡•à‡§∞ ‡§†‡§Ç‡§°‡•á',
            'mood_swings': '‡§Æ‡•Ç‡§° ‡§¨‡§¶‡§≤‡§®‡§æ', 'weight_loss': '‡§µ‡§ú‡§® ‡§ò‡§ü‡§®‡§æ', 'restlessness': '‡§¨‡•á‡§ö‡•à‡§®‡•Ä',
            'lethargy': '‡§∏‡•Å‡§∏‡•ç‡§§‡•Ä', 'patches_in_throat': '‡§ó‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§ß‡§¨‡•ç‡§¨‡•á', 'irregular_sugar_level': '‡§Ö‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∂‡•Å‡§ó‡§∞ ‡§∏‡•ç‡§§‡§∞',
            'cough': '‡§ñ‡§æ‡§Ç‡§∏‡•Ä', 'high_fever': '‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞', 'sunken_eyes': '‡§ß‡§Å‡§∏‡•Ä ‡§π‡•Å‡§à ‡§Ü‡§Å‡§ñ‡•á‡§Ç',
            'breathlessness': '‡§∏‡§æ‡§Ç‡§∏ ‡§´‡•Ç‡§≤‡§®‡§æ', 'sweating': '‡§™‡§∏‡•Ä‡§®‡§æ ‡§Ü‡§®‡§æ', 'dehydration': '‡§®‡§ø‡§∞‡•ç‡§ú‡§≤‡•Ä‡§ï‡§∞‡§£',
            'indigestion': '‡§Ö‡§™‡§ö', 'headache': '‡§∏‡§∞‡§¶‡§∞‡•ç‡§¶', 'yellowish_skin': '‡§™‡•Ä‡§≤‡•Ä ‡§§‡•ç‡§µ‡§ö‡§æ',
            'dark_urine': '‡§ó‡§π‡§∞‡§æ ‡§™‡•á‡§∂‡§æ‡§¨', 'nausea': '‡§ú‡•Ä ‡§Æ‡§ø‡§ö‡§≤‡§æ‡§®‡§æ', 'loss_of_appetite': '‡§≠‡•Ç‡§ñ ‡§® ‡§≤‡§ó‡§®‡§æ',
            'pain_behind_the_eyes': '‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡•á ‡§™‡•Ä‡§õ‡•á ‡§¶‡§∞‡•ç‡§¶', 'back_pain': '‡§ï‡§Æ‡§∞ ‡§¶‡§∞‡•ç‡§¶', 'constipation': '‡§ï‡§¨‡•ç‡§ú',
            'abdominal_pain': '‡§™‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶', 'diarrhoea': '‡§¶‡§∏‡•ç‡§§', 'mild_fever': '‡§π‡§≤‡•ç‡§ï‡§æ ‡§¨‡•Å‡§ñ‡§æ‡§∞',
            'yellow_urine': '‡§™‡•Ä‡§≤‡§æ ‡§™‡•á‡§∂‡§æ‡§¨', 'yellowing_of_eyes': '‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•Ä‡§≤‡§æ ‡§π‡•ã‡§®‡§æ',
            'acute_liver_failure': '‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§≤‡•Ä‡§µ‡§∞ ‡§µ‡§ø‡§´‡§≤‡§§‡§æ', 'fluid_overload': '‡§¶‡•ç‡§∞‡§µ ‡§Ö‡§§‡§ø‡§≠‡§æ‡§∞',
            'swelling_of_stomach': '‡§™‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡•Ç‡§ú‡§®', 'swelled_lymph_nodes': '‡§∏‡•Ç‡§ú‡•Ä ‡§π‡•Å‡§à ‡§≤‡§∏‡•Ä‡§ï‡§æ ‡§ó‡•ç‡§∞‡§Ç‡§•‡§ø‡§Ø‡§æ‡§Å',
            'malaise': '‡§Ö‡§∏‡•ç‡§µ‡§∏‡•ç‡§•‡§§‡§æ', 'blurred_and_distorted_vision': '‡§ß‡•Å‡§Ç‡§ß‡§≤‡•Ä ‡§î‡§∞ ‡§µ‡§ø‡§ï‡•É‡§§ ‡§¶‡•É‡§∑‡•ç‡§ü‡§ø', 'phlegm': '‡§¨‡§≤‡§ó‡§Æ',
            'throat_irritation': '‡§ó‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡§®', 'redness_of_eyes': '‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§ï‡§æ ‡§≤‡§æ‡§≤ ‡§π‡•ã‡§®‡§æ', 'sinus_pressure': '‡§∏‡§æ‡§á‡§®‡§∏ ‡§¶‡§¨‡§æ‡§µ',
            'runny_nose': '‡§¨‡§π‡§§‡•Ä ‡§®‡§æ‡§ï', 'congestion': '‡§ú‡§Æ‡§æ‡§µ', 'chest_pain': '‡§∏‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶',
            'weakness_in_limbs': '‡§π‡§æ‡§•-‡§™‡•à‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä', 'fast_heart_rate': '‡§§‡•á‡§ú ‡§¶‡§ø‡§≤ ‡§ï‡•Ä ‡§ß‡§°‡§º‡§ï‡§®',
            'pain_during_bowel_movements': '‡§∂‡•å‡§ö ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§¶‡§∞‡•ç‡§¶', 'pain_in_anal_region': '‡§ó‡•Å‡§¶‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶',
            'bloody_stool': '‡§ñ‡•Ç‡§®‡•Ä ‡§Æ‡§≤', 'irritation_in_anus': '‡§ó‡•Å‡§¶‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡§®', 'neck_pain': '‡§ó‡§∞‡•ç‡§¶‡§® ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§¶',
            'dizziness': '‡§ö‡§ï‡•ç‡§ï‡§∞ ‡§Ü‡§®‡§æ', 'cramps': '‡§ê‡§Ç‡§†‡§®', 'bruising': '‡§ö‡•ã‡§ü ‡§ï‡•á ‡§®‡§ø‡§∂‡§æ‡§®', 'obesity': '‡§Æ‡•ã‡§ü‡§æ‡§™‡§æ',
            'swollen_legs': '‡§∏‡•Ç‡§ú‡•á ‡§π‡•Å‡§è ‡§™‡•à‡§∞', 'swollen_blood_vessels': '‡§∏‡•Ç‡§ú‡•Ä ‡§π‡•Å‡§à ‡§∞‡§ï‡•ç‡§§ ‡§µ‡§æ‡§π‡§ø‡§ï‡§æ‡§è‡§Ç',
            'puffy_face_and_eyes': '‡§´‡•Ç‡§≤‡§æ ‡§π‡•Å‡§Ü ‡§ö‡•á‡§π‡§∞‡§æ ‡§î‡§∞ ‡§Ü‡§Å‡§ñ‡•á‡§Ç', 'enlarged_thyroid': '‡§¨‡§¢‡§º‡•Ä ‡§π‡•Å‡§à ‡§•‡§æ‡§Ø‡§∞‡•â‡§á‡§°',
            'brittle_nails': '‡§≠‡§Ç‡§ó‡•Å‡§∞ ‡§®‡§æ‡§ñ‡•Ç‡§®', 'swollen_extremeties': '‡§∏‡•Ç‡§ú‡•á ‡§π‡•Å‡§è ‡§Ö‡§Ç‡§ó', 'excessive_hunger': '‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§≠‡•Ç‡§ñ',
            'extra_marital_contacts': '‡§µ‡§ø‡§µ‡§æ‡§π ‡§¨‡§æ‡§π‡•ç‡§Ø ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï',
            'drying_and_tingling_lips': '‡§π‡•ã‡§Ç‡§†‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡•Ç‡§ñ‡§®‡§æ ‡§î‡§∞ ‡§ù‡•Å‡§®‡§ù‡•Å‡§®‡•Ä', 'slurred_speech': '‡§Ö‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§¨‡•ã‡§≤‡•Ä',
            'knee_pain': '‡§ò‡•Å‡§ü‡§®‡•á ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§¶', 'hip_joint_pain': '‡§ï‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡•á ‡§ú‡•ã‡§°‡§º ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§¶', 'muscle_weakness': '‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä',
            'stiff_neck': '‡§ï‡§°‡§º‡•Ä ‡§ó‡§∞‡•ç‡§¶‡§®', 'swelling_joints': '‡§∏‡•Ç‡§ú‡•á ‡§π‡•Å‡§è ‡§ú‡•ã‡§°‡§º', 'movement_stiffness': '‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§Ö‡§ï‡§°‡§º‡§®',
            'spinning_movements': '‡§ö‡§ï‡•ç‡§ï‡§∞‡§¶‡§æ‡§∞ ‡§ó‡§§‡§ø', 'loss_of_balance': '‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§ñ‡•ã‡§®‡§æ', 'unsteadiness': '‡§Ö‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ',
            'weakness_of_one_body_side': '‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•á ‡§è‡§ï ‡§§‡§∞‡§´ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä', 'loss_of_smell': '‡§ó‡§Ç‡§ß ‡§ï‡§æ ‡§®‡•Å‡§ï‡§∏‡§æ‡§®',
            'bladder_discomfort': '‡§Æ‡•Ç‡§§‡•ç‡§∞‡§æ‡§∂‡§Ø ‡§Æ‡•á‡§Ç ‡§¨‡•á‡§ö‡•à‡§®‡•Ä', 'foul_smell_of urine': '‡§™‡•á‡§∂‡§æ‡§¨ ‡§ï‡•Ä ‡§¨‡§¶‡§¨‡•Ç',
            'continuous_feel_of_urine': '‡§™‡•á‡§∂‡§æ‡§¨ ‡§ï‡§æ ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã‡§®‡§æ', 'passage_of_gases': '‡§ó‡•à‡§∏‡•ã‡§Ç ‡§ï‡§æ ‡§®‡§ø‡§ï‡§≤‡§®‡§æ',
            'internal_itching': '‡§Ü‡§Ç‡§§‡§∞‡§ø‡§ï ‡§ñ‡•Å‡§ú‡§≤‡•Ä', 'toxic_look_(typhos)': '‡§µ‡§ø‡§∑‡§æ‡§ï‡•ç‡§§ ‡§∞‡•Ç‡§™ (‡§ü‡§æ‡§á‡§´‡§∏)',
            'depression': '‡§Ö‡§µ‡§∏‡§æ‡§¶', 'irritability': '‡§ö‡§ø‡§°‡§º‡§ö‡§ø‡§°‡§º‡§æ‡§™‡§®', 'muscle_pain': '‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶',
            'altered_sensorium': '‡§¨‡§¶‡§≤‡§æ ‡§π‡•Å‡§Ü ‡§∏‡§Ç‡§µ‡•á‡§¶‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ', 'red_spots_over_body': '‡§∂‡§∞‡•Ä‡§∞ ‡§™‡§∞ ‡§≤‡§æ‡§≤ ‡§ß‡§¨‡•ç‡§¨‡•á',
            'belly_pain': '‡§™‡•á‡§ü ‡§¶‡§∞‡•ç‡§¶', 'abnormal_menstruation': '‡§Ö‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ß‡§∞‡•ç‡§Æ',
            'dischromic _patches': '‡§∞‡§Ç‡§ó‡§π‡•Ä‡§® ‡§ß‡§¨‡•ç‡§¨‡•á', 'watering_from_eyes': '‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§∏‡•á ‡§™‡§æ‡§®‡•Ä ‡§Ü‡§®‡§æ',
            'increased_appetite': '‡§¨‡§¢‡§º‡•Ä ‡§π‡•Å‡§à ‡§≠‡•Ç‡§ñ', 'polyuria': '‡§™‡•â‡§≤‡•Ä‡§Ø‡•Ç‡§∞‡§ø‡§Ø‡§æ (‡§Ö‡§ß‡§ø‡§ï ‡§™‡•á‡§∂‡§æ‡§¨)',
            'family_history': '‡§™‡§æ‡§∞‡§ø‡§µ‡§æ‡§∞‡§ø‡§ï ‡§á‡§§‡§ø‡§π‡§æ‡§∏', 'mucoid_sputum': '‡§∂‡•ç‡§≤‡•á‡§∑‡•ç‡§Æ‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§•‡•Ç‡§ï', 'rusty_sputum': '‡§ú‡§Ç‡§ó ‡§ú‡•à‡§∏‡§æ ‡§•‡•Ç‡§ï',
            'lack_of_concentration': '‡§è‡§ï‡§æ‡§ó‡•ç‡§∞‡§§‡§æ ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä', 'visual_disturbances': '‡§¶‡•É‡§∂‡•ç‡§Ø ‡§ó‡§°‡§º‡§¨‡§°‡§º‡•Ä',
            'receiving_blood_transfusion': '‡§∞‡§ï‡•ç‡§§ ‡§Ü‡§ß‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡§æ', 'receiving_unsterile_injections': '‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡§æ',
            'coma': '‡§ï‡•ã‡§Æ‡§æ', 'stomach_bleeding': '‡§™‡•á‡§ü ‡§∏‡•á ‡§ñ‡•Ç‡§® ‡§¨‡§π‡§®‡§æ', 'distention_of_abdomen': '‡§™‡•á‡§ü ‡§ï‡§æ ‡§´‡•Ç‡§≤‡§®‡§æ',
            'history_of_alcohol_consumption': '‡§∂‡§∞‡§æ‡§¨ ‡§™‡•Ä‡§®‡•á ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏', 'fluid_overload.1': '‡§¶‡•ç‡§∞‡§µ ‡§Ö‡§§‡§ø‡§≠‡§æ‡§∞ (Duplicate)',
            'blood_in_sputum': '‡§•‡•Ç‡§ï ‡§Æ‡•á‡§Ç ‡§ñ‡•Ç‡§®', 'prominent_veins_on_calf': '‡§™‡§ø‡§Ç‡§°‡§≤‡•Ä ‡§™‡§∞ ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§®‡§∏‡•á‡§Ç',
            'palpitations': '‡§ß‡§°‡§º‡§ï‡§®', 'painful_walking': '‡§¶‡§∞‡•ç‡§¶‡§®‡§æ‡§ï ‡§ö‡§≤‡§®‡§æ', 'pus_filled_pimples': '‡§™‡§∏ ‡§≠‡§∞‡•á ‡§¶‡§æ‡§®‡•á',
            'blackheads': '‡§¨‡•ç‡§≤‡•à‡§ï‡§π‡•á‡§°‡•ç‡§∏', 'scurring': '‡§®‡§ø‡§∂‡§æ‡§®', 'skin_peeling': '‡§§‡•ç‡§µ‡§ö‡§æ ‡§ï‡§æ ‡§õ‡§ø‡§≤‡§®‡§æ',
            'silver_like_dusting': '‡§ö‡§æ‡§Ç‡§¶‡•Ä ‡§ú‡•à‡§∏‡•Ä ‡§ß‡•Ç‡§≤', 'small_dents_in_nails': '‡§®‡§æ‡§ñ‡•Ç‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§õ‡•ã‡§ü‡•á ‡§ó‡§°‡•ç‡§¢‡•á',
            'inflammatory_nails': '‡§∏‡•Ç‡§ú‡§® ‡§µ‡§æ‡§≤‡•á ‡§®‡§æ‡§ñ‡•Ç‡§®', 'blister': '‡§õ‡§æ‡§≤‡§æ', 'red_sore_around_nose': '‡§®‡§æ‡§ï ‡§ï‡•á ‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ì‡§∞ ‡§≤‡§æ‡§≤ ‡§ò‡§æ‡§µ',
            'yellow_crust_ooze': '‡§™‡•Ä‡§≤‡•Ä ‡§™‡§™‡§°‡§º‡•Ä ‡§ï‡§æ ‡§∞‡§ø‡§∏‡§®‡§æ'
        };

        // Create a reverse map for quick lookups (Hindi/English to Symptom Key)
        const symptomReverseMap = {};
        for (const english in symptomMap) {
            const hindi = symptomMap[english];

            // Map 1: English key (cleaned)
            const cleanedEnglish = english.toLowerCase().replace(/_/g, ' ').trim();
            symptomReverseMap[cleanedEnglish] = english;

            // Map 2: Hindi value (exact) - Essential
            const cleanedHindi = hindi.toLowerCase().trim();
            symptomReverseMap[cleanedHindi] = english;

            // Map 3: Specific common Hindi words/phrases for better matching (The Comprehensive Update)

            // --- Pain / Aches ---
            if (english.includes('pain') || english.includes('ache') || english.includes('cramps')) {
                symptomReverseMap['‡§¶‡§∞‡•ç‡§¶'] = english;
                symptomReverseMap['‡§™‡•Ä‡§°‡§º‡§æ'] = english;
                symptomReverseMap['‡§§‡§ï‡§≤‡•Ä‡§´'] = english;
                symptomReverseMap['‡§ê‡§Ç‡§†‡§®'] = english; // cramps
                if (english.includes('stomach') || english.includes('abdominal') || english.includes('belly')) {
                    symptomReverseMap['‡§™‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶'] = english;
                    symptomReverseMap['‡§™‡•á‡§ü ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à'] = english;
                }
                if (english === 'headache') { symptomReverseMap['‡§∏‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶'] = english; }
                if (english === 'joint_pain') { symptomReverseMap['‡§ú‡•ã‡§°‡§º‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶'] = english; }
                if (english === 'back_pain') { symptomReverseMap['‡§ï‡§Æ‡§∞ ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶'] = english; }
                if (english === 'knee_pain') { symptomReverseMap['‡§ò‡•Å‡§ü‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶'] = english; }
                if (english === 'muscle_pain') { symptomReverseMap['‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•à'] = english; }
            }

            // --- Fever / Cold / Cough ---
            if (english.includes('fever')) {
                 symptomReverseMap['‡§¨‡•Å‡§ñ‡§æ‡§∞'] = english;
                 symptomReverseMap['‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§π‡•à'] = english;
                 symptomReverseMap['‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§π‡•à'] = english;
            }
            if (english === 'chills') {
                symptomReverseMap['‡§†‡§Ç‡§°'] = english;
                symptomReverseMap['‡§†‡§Ç‡§° ‡§≤‡§ó ‡§∞‡§π‡•Ä ‡§π‡•à'] = english;
                symptomReverseMap['‡§∏‡§∞‡•ç‡§¶‡•Ä'] = english;
            }
            if (english === 'shivering') { symptomReverseMap['‡§ï‡§Ç‡§™‡§ï‡§™‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'cough') { symptomReverseMap['‡§ñ‡§æ‡§Ç‡§∏‡•Ä ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'continuous_sneezing') {
                symptomReverseMap['‡§õ‡•Ä‡§Ç‡§ï'] = english;
                symptomReverseMap['‡§õ‡•Ä‡§Ç‡§ï ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à'] = english;
            }
            if (english === 'runny_nose') { symptomReverseMap['‡§®‡§æ‡§ï ‡§¨‡§π ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'congestion') { symptomReverseMap['‡§ú‡§Æ‡§æ‡§µ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à'] = english; }

            // --- Digestion / Nausea ---
            if (english === 'vomiting') { symptomReverseMap['‡§â‡§≤‡•ç‡§ü‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'nausea') {
                symptomReverseMap['‡§ú‡•Ä ‡§Æ‡§ø‡§ö‡§≤‡§æ ‡§∞‡§π‡§æ ‡§π‡•à'] = english;
                symptomReverseMap['‡§â‡§¨‡§ï‡§æ‡§à'] = english;
            }
            if (english === 'constipation') { symptomReverseMap['‡§ï‡§¨‡•ç‡§ú ‡§π‡•à'] = english; }
            if (english === 'diarrhoea') { symptomReverseMap['‡§¶‡§∏‡•ç‡§§ ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç'] = english; }
            if (english === 'loss_of_appetite') { symptomReverseMap['‡§≠‡•Ç‡§ñ ‡§®‡§π‡•Ä‡§Ç ‡§≤‡§ó ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'acidity') { symptomReverseMap['‡§è‡§∏‡§ø‡§°‡§ø‡§ü‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'indigestion') { symptomReverseMap['‡§Ö‡§™‡§ö ‡§π‡•à'] = english; }

            // --- Skin / Eyes ---
            if (english === 'itching' || english === 'internal_itching') {
                symptomReverseMap['‡§ñ‡•Å‡§ú‡§≤‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english;
                symptomReverseMap['‡§ñ‡•Å‡§ú‡§≤‡§æ‡§π‡§ü'] = english;
            }
            if (english === 'skin_rash') { symptomReverseMap['‡§¶‡§æ‡§®‡•á'] = english; }
            if (english === 'yellowish_skin') { symptomReverseMap['‡§§‡•ç‡§µ‡§ö‡§æ ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§°‡§º ‡§ó‡§à ‡§π‡•à'] = english; }
            if (english === 'redness_of_eyes') { symptomReverseMap['‡§Ü‡§Å‡§ñ‡•á‡§Ç ‡§≤‡§æ‡§≤ ‡§π‡•à‡§Ç'] = english; }
            if (english === 'watering_from_eyes') { symptomReverseMap['‡§Ü‡§Å‡§ñ‡•ã‡§Ç ‡§∏‡•á ‡§™‡§æ‡§®‡•Ä ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à'] = english; }

            // --- Fatigue / Weakness / Dizziness ---
            if (english === 'dizziness') {
                symptomReverseMap['‡§ö‡§ï‡•ç‡§ï‡§∞'] = english;
                symptomReverseMap['‡§ö‡§ï‡•ç‡§ï‡§∞ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à'] = english;
                symptomReverseMap['‡§ö‡§ï‡•ç‡§ï‡§∞ ‡§Ü ‡§∞‡§π‡•á ‡§π‡•à‡§Ç'] = english;
            }
            if (english === 'fatigue') { symptomReverseMap['‡§•‡§ï‡§æ‡§® ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'lethargy') { symptomReverseMap['‡§∏‡•Å‡§∏‡•ç‡§§‡•Ä ‡§π‡•à'] = english; }
            if (english === 'restlessness') { symptomReverseMap['‡§¨‡•á‡§ö‡•à‡§®‡•Ä ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'muscle_weakness' || english === 'weakness_in_limbs') { symptomReverseMap['‡§ï‡§Æ‡§ú‡•ã‡§∞‡•Ä ‡§π‡•à'] = english; }

            // --- Urinary / Bladder ---
            if (english === 'burning_micturition') { symptomReverseMap['‡§™‡•á‡§∂‡§æ‡§¨ ‡§Æ‡•á‡§Ç ‡§ú‡§≤‡§® ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à'] = english; }
            if (english === 'continuous_feel_of_urine') { symptomReverseMap['‡§¨‡§æ‡§∞ ‡§¨‡§æ‡§∞ ‡§™‡•á‡§∂‡§æ‡§¨ ‡§≤‡§ó ‡§∞‡§π‡§æ ‡§π‡•à'] = english; }

        }

        const symptomCheckboxesDiv = document.getElementById('symptomCheckboxes');
        const symptomsInput = document.getElementById('symptoms');
        const submitSymptomsButton = document.getElementById('submitSymptoms');
        const symptomModalElement = document.getElementById('symptomSelectModal');
        const doctorsModalElement = document.getElementById('doctorsModal');
        const micModalElement = document.getElementById('micModal');

        // Doctor Suggestion elements
        const suggestedExpert = document.getElementById('suggestedExpert');
        const suggestionDetails = document.getElementById('suggestionDetails');

        // Voice UI elements
        const liveTranscription = document.getElementById('liveTranscription');
        const transcriptionDiv = document.getElementById('transcription');
        const bootstrapMicModal = new bootstrap.Modal(micModalElement);

        // Doctor's Suggestion Logic (Unchanged)
        const doctorMap = {
            'Fungal infection': 'Dermatologist (‡§§‡•ç‡§µ‡§ö‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)', 'Allergy': 'Allergist / General Physician (‡§è‡§≤‡§∞‡•ç‡§ú‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û / ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)',
            'GERD': 'Gastroenterologist (‡§ó‡•à‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã‡§è‡§Ç‡§ü‡•á‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)', 'Chronic cholestasis': 'Hepatologist / Gastroenterologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§ó‡•à‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã‡§è‡§Ç‡§ü‡•á‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Drug Reaction': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'Peptic ulcer diseae': 'Gastroenterologist (‡§ó‡•à‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã‡§è‡§Ç‡§ü‡•á‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'AIDS': 'Immunologist / Infectious Disease Specialist (‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡§ï‡•ç‡§∑‡§æ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®‡•Ä / ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Æ‡§ï ‡§∞‡•ã‡§ó ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)', 'Diabetes ': 'Endocrinologist (‡§è‡§Ç‡§°‡•ã‡§ï‡•ç‡§∞‡§ø‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Gastroenteritis': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'Bronchial Asthma': 'Pulmonologist (‡§™‡§≤‡•ç‡§Æ‡•ã‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Hypertension ': 'Cardiologist (‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§Ø‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü) / General Physician', 'Migraine': 'Neurologist (‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Cervical spondylosis': 'Orthopedic / Physiotherapist (‡§π‡§°‡•ç‡§°‡•Ä ‡§∞‡•ã‡§ó ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û / ‡§´‡§ø‡§ú‡§ø‡§Ø‡•ã‡§•‡•á‡§∞‡•á‡§™‡§ø‡§∏‡•ç‡§ü)', 'Paralysis (brain hemorrhage)': 'Neurologist / Neurosurgeon (‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§∏‡§∞‡•ç‡§ú‡§®)',
            'Jaundice': 'Hepatologist / General Physician (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'Malaria': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)',
            'Chicken pox': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'Dengue': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)',
            'Typhoid': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'hepatitis A': 'Hepatologist / General Physician (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)',
            'Hepatitis B': 'Hepatologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)', 'Hepatitis C': 'Hepatologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Hepatitis D': 'Hepatologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)', 'Hepatitis E': 'Hepatologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Alcoholic hepatitis': 'Hepatologist / Gastroenterologist (‡§π‡•á‡§™‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§ó‡•à‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã‡§è‡§Ç‡§ü‡•á‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)', 'Tuberculosis': 'Pulmonologist (‡§™‡§≤‡•ç‡§Æ‡•ã‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü) / Infectious Disease Specialist',
            'Common Cold': 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)', 'Pneumonia': 'Pulmonologist (‡§™‡§≤‡•ç‡§Æ‡•ã‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Dimorphic hemmorhoids(piles)': 'Proctologist / General Surgeon (‡§™‡•ç‡§∞‡•ã‡§ï‡•ç‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§∞‡•ç‡§ú‡§®)', 'Heart attack': 'Cardiologist (‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§Ø‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Varicose veins': 'Vascular Surgeon (‡§µ‡•à‡§∏‡•ç‡§ï‡•Å‡§≤‡§∞ ‡§∏‡§∞‡•ç‡§ú‡§®)', 'Hypothyroidism': 'Endocrinologist (‡§è‡§Ç‡§°‡•ã‡§ï‡•ç‡§∞‡§ø‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Hyperthyroidism': 'Endocrinologist (‡§è‡§Ç‡§°‡•ã‡§ï‡•ç‡§∞‡§ø‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)', 'Hypoglycemia': 'Endocrinologist (‡§è‡§Ç‡§°‡•ã‡§ï‡•ç‡§∞‡§ø‡§®‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Osteoarthristis': 'Orthopedic (‡§π‡§°‡•ç‡§°‡•Ä ‡§∞‡•ã‡§ó ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)', 'Arthritis': 'Rheumatologist (‡§∞‡•Ç‡§Æ‡•á‡§ü‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü) / Orthopedic',
            '(vertigo) Paroymsal  Positional Vertigo': 'ENT Specialist / Neurologist (‡§à‡§è‡§®‡§ü‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û / ‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü)',
            'Acne': 'Dermatologist (‡§§‡•ç‡§µ‡§ö‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)', 'Urinary tract infection': 'Urologist / General Physician (‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü / ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)',
            'Psoriasis': 'Dermatologist (‡§§‡•ç‡§µ‡§ö‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)', 'Impetigo': 'Dermatologist (‡§§‡•ç‡§µ‡§ö‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û)'
        };

        function getDoctorSuggestion(disease) {
            const expert = doctorMap[disease] || 'General Physician (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§ï)';
            let details = `‡§á‡§∏ ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã **${expert}** ‡§∏‡•á ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§`;

            if(expert.includes('Hepatologist') || expert.includes('Gastroenterologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§™‡§æ‡§ö‡§® ‡§§‡§Ç‡§§‡•ç‡§∞, ‡§≤‡•Ä‡§µ‡§∞, ‡§™‡§ø‡§§‡•ç‡§§‡§æ‡§∂‡§Ø ‡§î‡§∞ ‡§Ö‡§ó‡•ç‡§®‡•ç‡§Ø‡§æ‡§∂‡§Ø ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Dermatologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§§‡•ç‡§µ‡§ö‡§æ, ‡§¨‡§æ‡§≤ ‡§î‡§∞ ‡§®‡§æ‡§ñ‡•Ç‡§® ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Cardiologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§π‡•É‡§¶‡§Ø ‡§î‡§∞ ‡§∞‡§ï‡•ç‡§§ ‡§µ‡§æ‡§π‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Pulmonologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§´‡•á‡§´‡§°‡§º‡•ã‡§Ç ‡§î‡§∞ ‡§∂‡•ç‡§µ‡§∏‡§® ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Neurologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§∏‡•ç‡§§‡§ø‡§∑‡•ç‡§ï, ‡§∞‡•Ä‡§¢‡§º ‡§ï‡•Ä ‡§π‡§°‡•ç‡§°‡•Ä ‡§î‡§∞ ‡§§‡§Ç‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Endocrinologist')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§π‡§æ‡§∞‡•ç‡§Æ‡•ã‡§® ‡§î‡§∞ ‡§ó‡•ç‡§∞‡§Ç‡§•‡§ø‡§Ø‡•ã‡§Ç (‡§ú‡•à‡§∏‡•á ‡§•‡§æ‡§Ø‡§∞‡•â‡§á‡§°, ‡§Æ‡§ß‡•Å‡§Æ‡•á‡§π) ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            } else if (expert.includes('Orthopedic')){
                 details += ` ‡§Ø‡•á ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§π‡§°‡•ç‡§°‡§ø‡§Ø‡•ã‡§Ç, ‡§ú‡•ã‡§°‡§º‡•ã‡§Ç ‡§î‡§∞ ‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§á‡§≤‡§æ‡§ú ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§`;
            }

            return { expert: expert, details: details };
        }

        if (doctorsModalElement) {
            doctorsModalElement.addEventListener('show.bs.modal', function () {
                const disease = '{{ predicted_disease }}';

                if (disease) {
                    const suggestion = getDoctorSuggestion(disease);
                    suggestedExpert.innerHTML = `Suggested Specialist: <br> <strong>${suggestion.expert}</strong>`;
                    suggestionDetails.textContent = suggestion.details;
                } else {
                    suggestedExpert.textContent = '‡§ï‡•ã‡§à ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§';
                    suggestionDetails.textContent = '‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡§ï‡•á ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§≤‡§ó‡§æ‡§è‡§Ç‡•§';
                }
            });
        }

        // Symptom Checkbox creation logic (Unchanged)
        function createCheckboxes(currentSymptoms) {
            symptomCheckboxesDiv.innerHTML = '';

            for (const english in symptomMap) {
                const hindi = symptomMap[english];
                const isChecked = currentSymptoms.includes(english.trim());

                const div = document.createElement('div');
                div.className = 'form-check';

                div.innerHTML = `
                    <input class="form-check-input" type="checkbox" value="${english}" id="check_${english}" ${isChecked ? 'checked' : ''}>
                    <label class="form-check-label" for="check_${english}">
                        ${hindi} <span style="font-size: 0.8em; color: #555555;">(${english.replace(/_/g, ' ')})</span>
                    </label>
                `;
                symptomCheckboxesDiv.appendChild(div);
            }
        }

        if (symptomModalElement) {
             symptomModalElement.addEventListener('show.bs.modal', function () {
                const currentInputValue = symptomsInput.value.trim();
                let currentSymptoms = [];
                if (currentInputValue) {
                    currentSymptoms = currentInputValue.split(',').map(s => s.trim()).filter(s => s);
                }
                createCheckboxes(currentSymptoms);
             });
        }

        submitSymptomsButton.addEventListener('click', function() {
            const checkedCheckboxes = symptomCheckboxesDiv.querySelectorAll('input[type="checkbox"]:checked');
            const selectedEnglishSymptoms = [];

            checkedCheckboxes.forEach(checkbox => {
                const englishSymptom = checkbox.value;
                selectedEnglishSymptoms.push(englishSymptom);
            });

            let existingSymptoms = symptomsInput.value.trim();
            let finalSymptomsArray = [];

            if (existingSymptoms) {
                finalSymptomsArray = existingSymptoms.split(',').map(s => s.trim()).filter(s => s);
            }

            const uniqueSymptomsSet = new Set(finalSymptomsArray);
            selectedEnglishSymptoms.forEach(symptom => {
                uniqueSymptomsSet.add(symptom);
            });

            const finalSymptomsString = Array.from(uniqueSymptomsSet).join(', ');
            symptomsInput.value = finalSymptomsString;
        });


        // =================================================================
        // UPDATED: Speech Recognition Logic with IMPROVED Mapping
        // =================================================================

        function mapToValidSymptoms(spokenText) {
            const normalizedText = spokenText.toLowerCase().trim();
            const recognizedSymptoms = new Set();
            let foundSymptomNames = [];

            // Check for phrase matches (this is the key for natural language processing)
            for (const spokenPhrase in symptomReverseMap) {
                // Check if the spoken text CONTAINS the phrase/keyword
                if (normalizedText.includes(spokenPhrase)) {
                    const validSymptomKey = symptomReverseMap[spokenPhrase];
                    recognizedSymptoms.add(validSymptomKey);
                }
            }

            // Create display names from recognized system keys
            recognizedSymptoms.forEach(key => {
                foundSymptomNames.push(symptomMap[key] || key.replace(/_/g, ' '));
            });

            // Return unique system keys and their display names
            return {
                keys: Array.from(recognizedSymptoms),
                display: Array.from(new Set(foundSymptomNames)).join(', ')
            };
        }


        const startSpeechRecognitionButton = document.getElementById('startSpeechRecognition');

        startSpeechRecognitionButton.addEventListener('click', startSpeechRecognition);

        function stopRecognitionManually() {
            if(recognition) {
                recognition.stop();
            }
        }

        function startSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Speech recognition is not supported in this browser. Please use Chrome.");
                return;
            }

            // Hide old transcription and show modal
            transcriptionDiv.textContent = '';
            liveTranscription.textContent = '‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å... (Listening...)';
            bootstrapMicModal.show();


            recognition = new webkitSpeechRecognition();
            recognition.lang = 'hi-IN'; // Set to Hindi for better Hindi/Hinglish recognition
            recognition.interimResults = true;

            recognition.onstart = function () {
                liveTranscription.textContent = '‡§¨‡•ã‡§≤‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...';
            };

            recognition.onresult = function (event) {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                // Show live transcription in the modal
                liveTranscription.textContent = interimTranscript || finalTranscript;

                if (finalTranscript) {
                    const mappingResult = mapToValidSymptoms(finalTranscript);

                    const systemSymptoms = mappingResult.keys.join(', ');
                    const readableSymptoms = mappingResult.display;

                    // Display the mapped symptoms to the user
                    if (systemSymptoms) {
                        transcriptionDiv.innerHTML = `‚úÖ **Recognized Symptoms (System Keys):** ${systemSymptoms} <br> üó£Ô∏è **Translated/Mapped Symptoms (User View):** ${readableSymptoms}`;
                    } else {
                        transcriptionDiv.textContent = `‚ùå Recognized Text: "${finalTranscript}". No matching symptoms found in the system database.`;
                    }

                    // Add result to symptoms input box (Only add valid keys)
                    if (systemSymptoms) {
                        let existingSymptoms = symptomsInput.value.trim();
                        let finalSymptomsSet = new Set();

                        // Add existing symptoms
                        if (existingSymptoms) {
                            existingSymptoms.split(',').map(s => s.trim()).filter(s => s).forEach(s => finalSymptomsSet.add(s));
                        }

                        // Add new mapped symptoms
                        mappingResult.keys.forEach(key => finalSymptomsSet.add(key));

                        // Update the input field
                        symptomsInput.value = Array.from(finalSymptomsSet).join(', ');
                    }
                }
            };

            recognition.onerror = function (event) {
                console.error('Speech recognition error:', event.error);
                liveTranscription.textContent = `üéôÔ∏è Error: ${event.error}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®: ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§`;
                bootstrapMicModal.hide();
            };

            recognition.onend = function () {
                console.log('Speech recognition ended.');
                bootstrapMicModal.hide();
            };

            recognition.start();
        }
    </script>
</body>

</html>

